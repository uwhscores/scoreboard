{% extends "/admin/admin_layout.html.j2" %}

{% block nav %}
	{% include "admin/nav_admin.html.j2" with context %}
{% endblock nav %}

{% block main %}

<div id="page_body" class="container">
	<div class="row">
		<div class="col-lg-12">
			<div class="page-header tournament-header">
			<h1 class="tournament-title">Timing Rules</h1>
			</div>
            {% with messages = get_flashed_messages() -%}
                {% if messages %}
                    {% set last="" -%}
                    <div class="alert alert-danger" role="alert">
                    {% for message in messages %}
                        {% if message != last -%}
                            {{ message }}</br>
                        {%- endif %}
                        {% set last=message %}
                    {% endfor %}
                    </div>
                {% endif %}
            {%- endwith %}
		</div>
	</div>

	<div class="row">
		<div class="col-lg-12">
        <div class="alert alert-warning" role="alert">
            For advanced users only. Be careful. This should be used only in a pinch.
        </div>
		<form action='/admin/t/{{tournament.short_name}}/update/updategametiming' method=post name='update'>
            <textarea id=timing_json rows="16" cols="80" name=timing_json>
            </textarea>
            </br>
            <input type='submit' class="btn btn-success" value=Update>
        </form>
		</div>
	</div>

</div>
<script>
$(document).ready(function(){

   $.ajax({
			{% if "localhost" in  request.host  -%}
			url: "http://{{request.host}}/api/v1/tournaments/{{tournament.tid}}/timingruleset",
			{%- else %}
			url: "https://{{request.host}}/api/v1/tournaments/{{tournament.tid}}/timingruleset",
			{%- endif %}
			type: 'GET',
			dataType: 'json',
			success: function(res) {
				document.getElementById("timing_json").innerHTML = JSON.stringify(res, null, 2)
			}
        });

})

</script>
{% endblock main %}
